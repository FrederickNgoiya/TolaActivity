(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{QTZG:function(e,t,r){"use strict";r.r(t);var n,o,i=r("q1tI"),l=r.n(i),a=r("i8i4"),s=r.n(a),c=r("okNM"),u=(r("qtBC"),r("TSYQ"),r("2vnA")),p=r("7O5W"),f=(r("IP2g"),r("wHSu"));function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function h(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),e}function b(e,t){return!t||"object"!==m(t)&&"function"!=typeof t?y(e):t}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}function w(e,t){return(w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}p.b.add(f.a,f.b);var E,O,C=function(e){function t(){return v(this,t),b(this,S(t).apply(this,arguments))}return g(t,l.a.Component),h(t,[{key:"render",value:function(){return l.a.createElement("h3",{className:"level-title "+this.props.classes},this.props.tierName,this.props.ontologyLabel?" "+this.props.ontologyLabel:null)}}]),t}(),_=Object(c.b)("rootStore")(n=Object(c.c)(n=function(e){function r(e){var t;return v(this,r),(t=b(this,S(r).call(this,e))).editLevel=function(){t.props.rootStore.uiStore.addExpandedCard(t.props.level.id)},t.deleteLevel=t.deleteLevel.bind(y(y(t))),t.editLevel=t.editLevel.bind(y(y(t))),t}return g(r,l.a.Component),h(r,[{key:"deleteLevel",value:function(){}},{key:"render",value:function(){return l.a.createElement("div",{className:"level-card level-card--collapsed",id:this.props.level.id},l.a.createElement("div",{className:"level-card--collapsed__name"},l.a.createElement("strong",null,l.a.createElement(C,{tierName:this.props.levelProps.tierName,ontologyLabel:this.props.levelProps.ontologyLabel,classes:"level-title--collapsed"})),l.a.createElement("span",null," ",this.props.level.name)),l.a.createElement("div",{className:"level-card--collapsed__actions"},l.a.createElement("div",{className:"actions__top",style:{display:"flex",justifyContent:"flex-end"}},this.props.levelProps.canDelete&&l.a.createElement("button",{className:"btn btn-sm btn-link btn-danger",onClick:this.deleteLevel},l.a.createElement("i",{className:"fas fa-trash-alt"})," ",gettext("Delete")),l.a.createElement("button",{className:"btn btn-sm btn-link btn-text",onClick:this.editLevel},l.a.createElement("i",{className:"fas fa-edit"})," ",gettext("Edit"))),l.a.createElement("div",{className:"actions__bottom",style:{display:"flex",justifyContent:"flex-end"}},l.a.createElement("button",{className:"btn btn-sm btn-link"},"Indicators"))))}}]),r}())||n)||n,j=Object(c.b)("rootStore")(o=Object(c.c)(o=function(e){function r(e){var t;return v(this,r),(t=b(this,S(r).call(this,e))).updateSubmitType=function(e){t.submitType=e},t.saveLevel=function(e){e.preventDefault();new FormData(e.target);t.props.rootStore.levelStore.saveLevelToDB(t.submitType,t.props.level.id,{name:t.name,assumptions:t.assumptions})},t.cancelEdit=function(e){t.props.rootStore.levelStore.cancelEdit(t.props.level.id)},t.onFormChange=function(e){e.preventDefault(),t[e.target.name]=e.target.value},t.submitType="saveOnly",Object(u.h)(y(y(t)),{name:e.level.name,assumptions:e.level.assumptions}),t}return g(r,l.a.Component),h(r,[{key:"render",value:function(){return l.a.createElement("div",{className:"level-card level-card--expanded",id:this.props.level.id},l.a.createElement("div",null,l.a.createElement(C,{tierName:this.props.levelProps.tierName,ontologyLabel:this.props.levelProps.ontologyLabel,classes:"level-title--expanded"})),l.a.createElement("form",{className:"level-card--expanded__form",onSubmit:this.saveLevel},l.a.createElement("textarea",{className:"form-control",type:"text",id:"level-name",name:"name",value:this.name||"",onChange:this.onFormChange}),l.a.createElement("label",{htmlFor:"assumptions"},"Assumptions"),l.a.createElement("textarea",{className:"form-control",type:"text",id:"level-assumptions",name:"assumptions",value:this.assumptions||"",onChange:this.onFormChange}),l.a.createElement(x,{level:this.props.level,submitFunc:this.updateSubmitType,cancelFunc:this.cancelEdit,tierCount:this.props.rootStore.levelStore.chosenTierSet.length})))}}]),r}())||o)||o,x=function(e){function t(){return v(this,t),b(this,S(t).apply(this,arguments))}return g(t,l.a.Component),h(t,[{key:"render",value:function(){var e=null;null!=this.props.level.parent&&"root"!=this.props.level.parent&&(e=l.a.createElement(T,{classes:"btn-primary",text:gettext("Save and another"),submitType:"saveAndAddSibling",submitFunc:this.props.submitFunc}));var t=null;return this.props.level.level_depth<this.props.tierCount&&(t=l.a.createElement(T,{classes:"btn-primary",text:gettext("Save and link"),submitType:"saveAndAddChild",submitFunc:this.props.submitFunc})),l.a.createElement("div",{className:"button-bar"},l.a.createElement(T,{classes:"btn-primary",text:gettext("Save and close"),submitType:"saveOnly",submitFunc:this.props.submitFunc}),e,t,l.a.createElement(T,{classes:"btn-reset",text:gettext("Cancel"),submitType:"cancel",submitFunc:this.props.cancelFunc}))}}]),t}(),T=function(e){function t(){return v(this,t),b(this,S(t).apply(this,arguments))}return g(t,l.a.Component),h(t,[{key:"render",value:function(){var e=this,t="cancel"==this.props.submitType?"button":"submit";return l.a.createElement("button",{type:t,className:this.props.classes+" level-button btn",onClick:function(){return e.props.submitFunc(e.props.submitType)}},this.props.text)}}]),t}();function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function L(e,t,r){return t&&P(e.prototype,t),r&&P(e,r),e}function F(e,t){return!t||"object"!==N(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function z(e){return(z=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&A(e,t)}function A(e,t){return(A=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}p.b.add(f.a,f.b);var R,B,q=Object(c.b)("rootStore")(E=Object(c.c)(E=function(e){function i(){return k(this,i),F(this,z(i).apply(this,arguments))}return D(i,l.a.Component),L(i,[{key:"render",value:function(){var o=this;return("initial"==this.props.renderList?this.props.rootStore.levelStore.sortedLevels.filter(function(e){return-1!=["root",null].indexOf(e.parent)}):this.props.renderList.sort(function(e,t){return e.customsort-t.customsort})).map(function(t){var e="";e=-1!==o.props.rootStore.uiStore.expandedCards.indexOf(t.id)?l.a.createElement(j,{level:t,levelProps:o.props.rootStore.levelStore.levelProperties[t.id]}):l.a.createElement(_,{level:t,levelProps:o.props.rootStore.levelStore.levelProperties[t.id]});var r=o.props.rootStore.levelStore.sortedLevels.filter(function(e){return e.parent==t.id}),n=null;return 0<r.length&&(n=l.a.createElement(i,{rootStore:o.props.rootStore,renderList:r})),l.a.createElement("div",{key:t.id,className:"leveltier--new"},e,n)})}}]),i}())||E)||E,I=Object(c.b)("rootStore")(O=Object(c.c)(O=function(e){function t(){return k(this,t),F(this,z(t).apply(this,arguments))}return D(t,l.a.Component),L(t,[{key:"render",value:function(){return 0==this.props.rootStore.levelStore.levels.length?l.a.createElement("div",{style:{display:"flex",flexDirection:"row"}},l.a.createElement("img",{src:"/static/img/tripleDrum.jpg",alt:"Result logic tree",style:{maxWidth:"300px",maxHeight:"300px"}}),l.a.createElement("div",null,l.a.createElement("span",{className:"level-list__empty--warning"},"Choose your results framework template carefully!")," Once you begin building your framework, it will not be possible to change templates without first deleting all saved levels.")):l.a.createElement("div",{id:"level-list",style:{flexGrow:"2"}},l.a.createElement(q,{renderList:"initial"}))}}]),t}())||O)||O,J=r("y2Vs");function G(e){return(G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function X(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function $(e,t,r){return t&&X(e.prototype,t),r&&X(e,r),e}function H(e,t){return!t||"object"!==G(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Z(e,t)}function Z(e,t){return(Z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var U=Object(c.b)("rootStore")(R=Object(c.c)(R=function(e){function i(){var e,t;Q(this,i);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=H(this,(e=M(i)).call.apply(e,[this].concat(n)))).handleChange=function(e){t.props.rootStore.levelStore.changeTierSet(e.value)},t}return W(i,l.a.Component),$(i,[{key:"render",value:function(){var e=Object.keys(this.props.rootStore.levelStore.tierPresets).map(function(e){return{value:e,label:e}}),t={value:this.props.rootStore.levelStore.chosenTierSet,label:this.props.rootStore.levelStore.chosenTierSetName};return l.a.createElement("div",{className:"leveltier-picker__selectbox"},"Results framework template",l.a.createElement(J.default,{options:e,value:t,onChange:this.handleChange}))}}]),i}())||R)||R,V=function(e){function t(){return Q(this,t),H(this,M(t).apply(this,arguments))}return W(t,l.a.Component),$(t,[{key:"render",value:function(){return l.a.createElement("div",{className:"leveltier leveltier--level-"+this.props.tierLevel},this.props.tierName," ")}}]),t}(),Y=Object(c.b)("rootStore")(B=Object(c.c)(B=function(e){function t(){return Q(this,t),H(this,M(t).apply(this,arguments))}return W(t,l.a.Component),$(t,[{key:"render",value:function(){var e=null;return 0==this.props.rootStore.levelStore.levels.length&&(e=l.a.createElement("button",{className:"leveltier-button",onClick:this.props.rootStore.levelStore.createFirstLevel},"Apply")),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{id:"leveltier-list",className:"leveltier-list"},0<this.props.rootStore.levelStore.chosenTierSet.length?this.props.rootStore.levelStore.chosenTierSet.map(function(e,t){return l.a.createElement(V,{key:t,tierName:e})}):null),e)}}]),t}())||B)||B,K=Object(c.c)(function(e){return l.a.createElement("div",{id:"leveltier-picker",className:"leveltier-picker"},l.a.createElement(U,null),l.a.createElement(Y,null))});var ee,te,re,ne,oe,ie,le,ae,se,ce,ue,pe,fe=r("XoI5");function me(e,t,r,n){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function ve(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function de(r,n,e,t,o){var i={};return Object.keys(t).forEach(function(e){i[e]=t[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=e.slice().reverse().reduce(function(e,t){return t(r,n,e)||e},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(r,n,i),i=null),i}function he(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var be=(te=de((ee=function(){function l(e,t,r,n,o){var i=this;he(this,l),me(this,"levels",te,this),me(this,"chosenTierSet",re,this),me(this,"chosenTierSetName",ne,this),this.tierPresets={},this.defaultPreset="Mercy Corps standard",this.program_id="",me(this,"cancelEdit",oe,this),me(this,"createNewLevelFromSibling",ie,this),me(this,"createFirstLevel",le,this),this.saveLevelTiersToDB=function(){var e={program_id:i.program_id,tiers:i.chosenTierSet};fe.a.post("/save_leveltiers/",e).then(function(e){}).catch(function(e){})},this.saveLevelToDB=function(t,r,e){var n=i.levels.find(function(e){return e.id==r}),o=Object.assign(Object(u.p)(n),e);"new"==r?("root"==o.parent&&i.saveLevelTiersToDB(),delete o.id,fe.a.post("/insert_new_level/",o).then(function(e){Object(u.n)(function(){i.levels.replace(e.data)})}).catch(function(e){})):fe.a.put("/level/".concat(r,"/"),o).then(function(e){Object(u.n)(function(){Object.assign(n,e.data)}),i.rootStore.uiStore.removeExpandedCard(r),"saveAndAddSibling"==t&&i.createNewLevelFromSibling(r)}).catch(function(e){})},this.buildOntology=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=Object(u.p)(i.levels.find(function(e){return e.id==t}));return r.parent&&"root"!=r.parent?(e.unshift(r.customsort),i.buildOntology(r.parent,e)):e.join(".")},this.rootStore=o,this.levels=t,this.tierPresets=n,this.program_id=e,0<r.length?(this.chosenTierSet=r.map(function(e){return e.name}),this.chosenTierSetName=this.derive_preset_name(r,n)):(this.chosenTierSetName=this.defaultPreset,this.chosenTierSet=this.tierPresets[this.defaultPreset])}var e,t,r;return e=l,(t=[{key:"changeTierSet",value:function(e){this.chosenTierSetName=e,this.chosenTierSet=this.tierPresets[e]}},{key:"derive_preset_name",value:function(e,t){if(!e)return None;var r=e.sort(function(e){return e.tier_depth}).map(function(e){return e.name}),n=JSON.stringify(r);for(var o in t){if(e.length==t[o].length)if(n==JSON.stringify(t[o]))return o}return"Custom"}},{key:"sortedLevels",get:function(){return this.levels.slice().sort(function(e,t){e.level_depth-t.level_depth||(e.customsort,t.customsort)})}},{key:"levelProperties",get:function(){var n=this,o={},e=!0,t=!1,r=void 0;try{for(var i,l=function(){var t=i.value,e={};e.ontologyLabel=n.buildOntology(t.id),e.tierName=n.chosenTierSet[t.level_depth-1];var r=n.levels.filter(function(e){return e.parent==t.id}).length;e.canDelete=0==r,o[t.id]=e},a=this.levels[Symbol.iterator]();!(e=(i=a.next()).done);e=!0)l()}catch(e){t=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}return o}}])&&ve(e.prototype,t),r&&ve(e,r),l}()).prototype,"levels",[u.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),re=de(ee.prototype,"chosenTierSet",[u.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ne=de(ee.prototype,"chosenTierSetName",[u.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),de(ee.prototype,"sortedLevels",[u.e],Object.getOwnPropertyDescriptor(ee.prototype,"sortedLevels"),ee.prototype),de(ee.prototype,"levelProperties",[u.e],Object.getOwnPropertyDescriptor(ee.prototype,"levelProperties"),ee.prototype),de(ee.prototype,"changeTierSet",[u.d],Object.getOwnPropertyDescriptor(ee.prototype,"changeTierSet"),ee.prototype),oe=de(ee.prototype,"cancelEdit",[u.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){t.rootStore.uiStore.removeExpandedCard(e),t.levels.replace(t.levels.filter(function(e){return"new"!=e.id}))}}}),ie=de(ee.prototype,"createNewLevelFromSibling",[u.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var n=this;return function(t){var r=Object(u.p)(n.levels.find(function(e){return e.id==t})),e=Object.assign({},r);e.customsort+=1,e.id="new",e.name="",e.assumptions="",n.levels.filter(function(e){return e.customsort>r.customsort&&e.parent==r.parent}).forEach(function(e){return e.customsort+=1}),n.rootStore.uiStore.expandedCards.push("new"),n.rootStore.uiStore.activeCard="new",n.levels.push(e)}}}),le=de(ee.prototype,"createFirstLevel",[u.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){var e={id:"new",program:t.program_id,name:"",assumptions:"",customsort:1,level_depth:1,parent:"root"};t.levels.push(e),t.rootStore.uiStore.expandedCards.push("new")}}}),ee),ye=(se=de((ae=function e(t){he(this,e),me(this,"expandedCards",se,this),me(this,"activeLevel",ce,this),me(this,"addExpandedCard",ue,this),me(this,"removeExpandedCard",pe,this),this.rootStore=t}).prototype,"expandedCards",[u.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ce=de(ae.prototype,"activeLevel",[u.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ue=de(ae.prototype,"addExpandedCard",[u.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){t.expandedCards.includes(e)||t.expandedCards.push(e)}}}),pe=de(ae.prototype,"removeExpandedCard",[u.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.expandedCards=e.expandedCards.filter(function(e){return e!=t})}}}),ae),Se=jsContext,ge=new function e(t,r,n,o){he(this,e),this.levelStore=new be(t,r,n,o,this),this.uiStore=new ye(this)}(Se.program_id,Se.levels,Se.levelTiers,Se.tierPresets);s.a.render(l.a.createElement(c.a,{rootStore:ge},l.a.createElement(l.a.Fragment,null,l.a.createElement(K,null),l.a.createElement(I,null))),document.querySelector("#level-builder-react-component"))},XoI5:function(e,t,r){"use strict";r.d(t,"a",function(){return o});var n=r("vDqi"),o=r.n(n).a.create({withCredentials:!0,baseURL:"/api/",headers:{"X-CSRFToken":document.cookie.replace(/(?:(?:^|.*;\s*)csrftoken\s*\=\s*([^;]*).*$)|^.*$/,"$1")}})},qtBC:function(e,t,r){"use strict";var n=r("7+Rn"),o=r.n(n)()();t.a=o}},[["QTZG",0,1]]]);