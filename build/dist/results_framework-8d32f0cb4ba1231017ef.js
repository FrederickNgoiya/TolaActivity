(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"4L+s":function(e,t,r){"use strict";r.d(t,"b",function(){return f}),r.d(t,"a",function(){return v});var n=r("q1tI"),i=r.n(n),o=r("i8i4"),l=r.n(o);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function u(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&m(e,t)}function m(e,t){return(m=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var f=function(e){function r(e){var t;return s(this,r),(t=u(this,p(r).call(this,e))).content=e.content,t.placement=e.placement||null,t}var t,n,o;return d(r,i.a.Component),t=r,(n=[{key:"render",value:function(){return i.a.createElement("a",{tabIndex:"0","data-toggle":"popover","data-trigger":"focus","data-html":"true","data-placement":this.placement,"data-content":this.content},i.a.createElement("i",{className:"far fa-question-circle"}))}}])&&c(t.prototype,n),o&&c(t,o),r}(),v=function(e){function a(){var e,r;s(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(r=u(this,(e=p(a)).call.apply(e,[this].concat(n)))).popoverName="base",r.componentDidMount=function(){r.bodyClickHandler=function(e){0==$("#".concat(r.popoverName,"_popover_content")).parent().find($(e.target)).length&&$(r.refs.target).popover("hide")};var t=function(){$("body").on("click",r.bodyClickHandler),$(r.refs.target).popover("update").on("hide.bs.popover",function(){$("body").off("click",r.bodyClickHandler)})};$(r.refs.target).popover({content:'<div id="'.concat(r.popoverName,'_popover_content"></div>'),html:!0,placement:"bottom"}).on("shown.bs.popover",function(e){l.a.render(r.getPopoverContent(),document.querySelector("#".concat(r.popoverName,"_popover_content")),t)})},r.getPopoverContent=function(){throw new Error("not implemented")},r}return d(a,i.a.Component),a}()},Ez0T:function(e,t,r){"use strict";var n=r("q1tI"),a=r.n(n),i=r("y2Vs"),o=r("VCnP"),l=r.n(o),s=0;function c(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"id";return s++,"".concat(e).concat(s)}function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function p(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(e){d(t,e,r[e])})}return t}function d(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.d(t,"c",function(){return m}),r.d(t,"a",function(){return f}),r.d(t,"d",function(){return v}),r.d(t,"b",function(){return b});var m=function(e){var t=c("react-select"),r=e.labelClasses||"col-form-label text-uppercase",n=e.formRowClasses||"form-row mb-3",o=e.selectClasses||"tola-react-select";return a.a.createElement("div",{className:n},a.a.createElement("label",{htmlFor:t,className:r},e.label),a.a.createElement(i.default,{onChange:e.update,value:e.value,id:t,className:o,isDisabled:e.disabled,options:e.options}))},f=function(e){var t=c("date-select"),r=e.options&&1==e.options.length&&void 0!==e.options[0].value?a.a.createElement("option",{value:e.options[0].value},e.options[0].label):e.options&&void 0!==e.options[0].options?e.options.map(function(e,t){return a.a.createElement("optgroup",{label:e.label,key:t},e.options.map(function(e){return a.a.createElement("option",{value:e.value,key:e.value},e.label)}))}):e.options.map(function(e,t){return a.a.createElement("option",{value:e.value,key:t},e.label)});return a.a.createElement("div",{className:"form-row mb-3"},a.a.createElement("label",{htmlFor:t,className:"col-form-label text-uppercase"},e.label),a.a.createElement("select",{className:"form-control",id:t,value:e.value,onChange:e.update,disabled:e.disabled},r))},v=function(e){var t=c("react-select");return a.a.createElement("div",{className:"form-row mb-3"},a.a.createElement("label",{htmlFor:t,className:"col-form-label text-uppercase"},e.label),a.a.createElement("select",{onChange:e.update,value:e.value,id:t,className:"form-control",disabled:e.disabled},e.options))},h=function(e){return""==e.children?a.a.createElement("div",null):a.a.createElement(a.a.Fragment,null,a.a.createElement("hr",{style:{margin:"3px 0px 0px 0px"}}),a.a.createElement("div",{className:"text-muted",style:{textTransform:"uppercase",paddingLeft:"4px",marginBottom:"2px"}},e.children))},b=function(t){var e=c("multiselect"),r=t.options&&0!=t.options.length?{isMulti:!0,options:t.options,getDropdownButtonLabel:function(e){return e.value?Array.isArray(e.value)?0==e.value.length?gettext("None selected"):1==e.value.length?e.value[0].label:"".concat(e.value.length,"  ").concat(gettext("selected")):e.value.label:gettext("None selected")}}:{getDropdownButtonLabel:function(){return gettext("None available")},isDisabled:!0,menuIsOpen:!1,options:[]},n={dropdownButton:function(e){return t.options&&0!=t.options.length?e:p({},e,{backgroundColor:"#E5E6E8",background:""})},option:function(e,t){return p({},e,{padding:"1px 12px",display:"inline-block"})},container:function(e,t){return p({},e,{backgroundColor:"#f5f5f5"})}};return a.a.createElement("div",{className:"form-row mb-2 tola-react-multiselect-row"},a.a.createElement("label",{htmlFor:e,className:"col-form-label text-uppercase"},t.label),a.a.createElement(l.a,u({id:e,styles:n,formatOptionLabel:function(e){return a.a.createElement("div",{style:{display:"inline-block",float:"right",width:"90%"}},e.label)},components:{GroupHeading:h},value:t.value,onChange:t.update},r)))}},QTZG:function(e,t,r){"use strict";r.r(t);var n,o,a,i,l=r("q1tI"),p=r.n(l),s=r("i8i4"),c=r.n(s),u=r("okNM"),d=(r("qtBC"),r("TSYQ"),r("2vnA")),m=r("7O5W"),f=r("IP2g"),v=r("wHSu"),h=r("Ez0T"),b=r("hzyr"),y=r("0zu5"),g=r("4L+s");function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _(e,t,r){return t&&w(e.prototype,t),r&&w(e,r),e}function C(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?O(e):t}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function N(e){return(N=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}m.b.add(v.b,v.c,v.a);var x,P,j=function(e){function t(){return E(this,t),C(this,N(t).apply(this,arguments))}return T(t,p.a.Component),_(t,[{key:"render",value:function(){return p.a.createElement("h3",{className:"level-title "+this.props.classes},this.props.tierName,this.props.ontologyLabel?" "+this.props.ontologyLabel:null)}}]),t}(),L=Object(u.b)("rootStore")(n=Object(u.c)(n=function(e){function a(){var e,r;E(this,a);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return(r=C(this,(e=N(a)).call.apply(e,[this].concat(n)))).deleteLevel=function(){var e=r.props.levelProps.tierName+" "+r.props.levelProps.ontologyLabel;create_no_rationale_changeset_notice({message_text:"Are you sure you want to delete ".concat(e,"?"),on_submit:function(){return r.props.rootStore.levelStore.deleteLevelFromDB(r.props.level.id)}})},r.editLevel=function(){r.props.rootStore.uiStore.editCard(r.props.level.id)},r.buildIPTTUrl=function(e){var t="/indicators/iptt_report/".concat(r.props.rootStore.levelStore.program_id,"/timeperiods/?frequency=3&start=0&end=999");return e.forEach(function(e){return t+="&indicators="+e}),t},r}return T(a,p.a.Component),_(a,[{key:"componentDidMount",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"render",value:function(){var n=this;if(this.props.rootStore.uiStore.hasVisibleChildren.indexOf(this.props.level.parent)<0&&null!=this.props.level.parent)return null;var e=[],t=this.props.levelProps.indicators.map(function(e){return e.id});if(0<t.length){var r="All indicators linked to ".concat(this.props.levelProps.tierName," ").concat(this.props.levelProps.ontologyLabel);e.push("<a href=".concat(this.buildIPTTUrl(t),">").concat(r,"</a>"))}if(this.props.levelProps.tierName!=this.props.rootStore.levelStore.chosenTierSet.slice(-1)[0]){var o=this.props.levelProps.descendantIndicatorIds;if(0<(o=o.concat(t)).length){var a="All indicators linked to ".concat(this.props.levelProps.tierName," ").concat(this.props.levelProps.ontologyLabel," and sub-levels");e.unshift("<a href=".concat(this.buildIPTTUrl(o),">").concat(a,"</a>"))}}var i=this.props.levelProps.indicators.map(function(e,t){var r=n.props.levelProps.ontologyLabel+String.fromCharCode(97+t)+": ";return'<li class="nav-item"><a href='.concat(n.buildIPTTUrl([e.id]),">").concat(r).concat(e.name,"</a></li>")});e=e.concat(i);var l='<ul class="nav flex-column">'.concat(e.join("<br>"),"</ul>"),s=this.props.levelProps.indicators.length,c=interpolate(ngettext("%s indicator","%s indicators",s),[s]),u=null;return this.props.levelProps.tierName!=Object(d.q)(this.props.rootStore.levelStore.chosenTierSet.slice(-1)[0])&&0<this.props.rootStore.levelStore.levels.filter(function(e){return e.parent==n.props.level.id}).length&&(u=p.a.createElement(f.a,{className:"text-action",icon:0<=this.props.rootStore.uiStore.hasVisibleChildren.indexOf(this.props.level.id)?"caret-down":"caret-right"})),p.a.createElement("div",{className:"level-card level-card--collapsed",id:"level-card-".concat(this.props.level.id)},p.a.createElement("div",{className:u?"level-card__toggle":"",onClick:function(e){return n.props.rootStore.uiStore.updateVisibleChildren(n.props.level.id)}},u,p.a.createElement("span",{className:"level-card--collapsed__name"},p.a.createElement(j,{tierName:this.props.levelProps.tierName,ontologyLabel:this.props.levelProps.ontologyLabel,classes:"level-title--collapsed"})," ",this.props.level.name)),p.a.createElement("div",{className:"level-card--collapsed__actions"},p.a.createElement("div",{className:"actions__top btn-row"},this.props.levelProps.canDelete&&p.a.createElement("button",{className:"btn btn-sm btn-link btn-danger",onClick:this.deleteLevel},p.a.createElement("i",{className:"fas fa-trash-alt"}),gettext("Delete")),this.props.levelProps.canEdit&&p.a.createElement("button",{className:"btn btn-sm btn-link btn-text edit-button",onClick:this.editLevel},p.a.createElement("i",{className:"fas fa-edit"}),gettext("Edit"))),p.a.createElement("div",{className:"actions__bottom"},p.a.createElement("button",{className:"btn btn-sm btn-link no-bold","data-toggle":"popover","data-trigger":"focus","data-placement":"bottom","data-html":"true",title:"Track indicator performance","data-content":l,disabled:0==e.length},c))))}}]),a}())||n)||n,F=Object(u.b)("rootStore")(o=Object(u.c)(o=function(e){function t(e){var a;return E(this,t),(a=C(this,N(t).call(this,e))).onDragEnd=function(e){var t=e.oldIndex,r=e.newIndex;a.indicatorWasReordered=!0;var n=a.indicators[t].id,o={value:r+1,name:r+1};a.updateIndicatorOrder(o,n)},a.updateIndicatorOrder=function(e,t){a.indicatorWasReordered=!0;var r=a.indicators.find(function(e){return e.id==t}).level_order,n=e.value-1,o=a.indicators.slice();o.splice(n,0,o.splice(r,1)[0]),o.forEach(function(e,t){return e.level_order=t}),a.indicators.replace(o),a.props.rootStore.uiStore.activeCardNeedsConfirm=a.dataHasChanged},a.updateSubmitType=function(e){a.submitType=e},a.saveLevel=function(e){e.preventDefault(),a.props.rootStore.levelStore.saveLevelToDB(a.submitType,a.props.level.id,a.indicatorWasReordered,{name:a.name,assumptions:a.assumptions,indicators:Object(d.q)(a.indicators)})},a.cancelEdit=function(){a.dataHasChanged?create_no_rationale_changeset_notice({message_text:gettext("Are you sure you want to continue?"),preamble:gettext("Changes to this ".concat(a.props.levelProps.tierName," will not be saved")),on_submit:function(){return a.props.rootStore.levelStore.cancelEdit(a.props.level.id)}}):a.props.rootStore.levelStore.cancelEdit(a.props.level.id)},a.onFormChange=function(e){if(e.preventDefault(),a[e.target.name]=e.target.value,a.name)$("#level-name-".concat(a.props.level.id)).removeClass("is-invalid"),$("#name-feedback-".concat(a.props.level.id)).remove();else{var t=$("#level-name-".concat(a.props.level.id));t.addClass("is-invalid");var r="Please provide a name for this ".concat(a.props.levelProps.tierName);t.after("<p id=name-feedback-".concat(a.props.level.id,' class="invalid-feedback">').concat(r,"</p>"))}a.props.rootStore.uiStore.activeCardNeedsConfirm=a.dataHasChanged},a.submitType="saveOnly",a.indicatorWasReordered=!1,a.origData=JSON.stringify([e.level.name,e.level.assumptions,e.levelProps.indicators]),Object(d.h)(O(O(a)),{name:e.level.name,assumptions:e.level.assumptions,indicators:e.levelProps.indicators.sort(function(e,t){return e.level_order-t.level_order}),get dataHasChanged(){return JSON.stringify([this.name,this.assumptions,this.indicators])!=this.origData}}),a}return T(t,p.a.Component),_(t,[{key:"componentDidMount",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"render",value:function(){Object(d.q)(this.indicators);return p.a.createElement("div",{className:"level-card level-card--expanded",id:"level-card-".concat(this.props.level.id)},p.a.createElement("div",null,p.a.createElement(j,{tierName:this.props.levelProps.tierName,ontologyLabel:this.props.levelProps.ontologyLabel,classes:"level-title--expanded"})),p.a.createElement("form",{className:"level-card--expanded__form",onSubmit:this.saveLevel},p.a.createElement("div",{className:"form-group"},p.a.createElement("textarea",{className:"form-control",id:"level-name-".concat(this.props.level.id),name:"name",value:this.name||"",autoComplete:"off",onChange:this.onFormChange})),p.a.createElement("div",{className:"form-group"},p.a.createElement("label",{htmlFor:"assumptions"},"Assumptions"),p.a.createElement("textarea",{className:"form-control",id:"level-assumptions",disabled:this.name?"":"disabled",name:"assumptions",autoComplete:"off",value:this.assumptions||"",onChange:this.onFormChange})),p.a.createElement(A,{level:this.props.level,tierName:this.props.levelProps.tierName,indicators:this.indicators,disabled:!this.name,changeFunc:this.updateIndicatorOrder,dragEndFunc:this.onDragEnd}),p.a.createElement(I,{level:this.props.level,levelProps:this.props.levelProps,submitFunc:this.updateSubmitType,cancelFunc:this.cancelEdit,nameVal:this.name,tierCount:this.props.rootStore.levelStore.chosenTierSet.length})))}}]),t}())||o)||o,I=Object(u.b)("rootStore")(a=function(e){function t(){return E(this,t),C(this,N(t).apply(this,arguments))}return T(t,p.a.Component),_(t,[{key:"render",value:function(){var e=this.props.nameVal?"":"disabled",t=null;if(null!=this.props.level.parent&&"root"!=this.props.level.parent){var r=interpolate(gettext("Save and add another %s"),[this.props.levelProps.tierName]);t=p.a.createElement(D,{disabledText:e,classes:"btn-primary",icon:"plus-circle",text:r,submitType:"saveAndAddSibling",submitFunc:this.props.submitFunc})}var n=null,o=this.props.rootStore.levelStore.chosenTierSet.length;if(this.props.level.level_depth<o){var a=interpolate(gettext("Save and link %s"),[this.props.levelProps.childTierName]);n=p.a.createElement(D,{disabledText:e,classes:"btn btn-primary",icon:"stream",text:a,submitType:"saveAndAddChild",submitFunc:this.props.submitFunc})}return p.a.createElement("div",{className:"button-bar btn-row"},p.a.createElement(D,{disabledText:e,classes:"btn-primary",text:gettext("Save and close"),icon:"save",submitType:"saveOnly",submitFunc:this.props.submitFunc}),t,n,p.a.createElement(D,{classes:"btn btn-reset",text:gettext("Cancel"),submitType:"cancel",submitFunc:this.props.cancelFunc}))}}]),t}())||a,D=function(e){function t(){return E(this,t),C(this,N(t).apply(this,arguments))}return T(t,p.a.Component),_(t,[{key:"render",value:function(){var e=this,t="cancel"==this.props.submitType?"button":"submit";return p.a.createElement("button",{disabled:this.props.disabledText,type:t,className:this.props.classes+" level-button btn btn-sm",onClick:function(){return e.props.submitFunc(e.props.submitType)}},this.props.text)}}]),t}(),A=Object(u.b)("rootStore")(i=function(e){function t(){return E(this,t),C(this,N(t).apply(this,arguments))}return T(t,p.a.Component),_(t,[{key:"componentDidMount",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"render",value:function(){var r=this,e=this.props.indicators.map(function(e,t){return{value:t+1,label:t+1}}),t=this.props.indicators.map(function(t){return p.a.createElement(p.a.Fragment,null,p.a.createElement(h.c,{update:function(e){return r.props.changeFunc(e,t.id)},selectId:"ind"+t.id,labelClasses:" ",formRowClasses:"sortable-list__item__label",selectClasses:"sortable-list__item__select",value:{value:t.level_order,label:t.level_order+1},label:t.name,options:e,disabled:r.props.disabled}),p.a.createElement("div",{className:"sortable-list__item__actions"},p.a.createElement("a",{href:"#",className:"indicator-link"},p.a.createElement("i",{className:"fas fa-cog"})," ",gettext("Settings"))))}),n=null,o=null,a=gettext("To remove an indicator: Click “Settings”, where you can reassign the indicator to a different level or delete it.");return 0<this.props.indicators.length&&(n="Order",o=p.a.createElement(g.b,{content:a,placement:"bottom"})),p.a.createElement("div",{className:"level-card--indicator-links ".concat(this.props.disabled?"disabled":null)},p.a.createElement("div",{className:"indicator-links__header"},p.a.createElement("h4",null,gettext("Indicators linked to this ".concat(this.props.tierName))),p.a.createElement("div",null,o)),p.a.createElement("div",{className:"sortable-list-group"},0<this.props.indicators.length?p.a.createElement("div",{className:"sortable-list-header"},p.a.createElement("div",{className:"sortable-list-header__drag-handle"},p.a.createElement(f.a,{icon:v.a})),p.a.createElement("div",{className:"sortable-list-header__label"},n),p.a.createElement("div",{className:"sortable-list-header__actions"},p.a.createElement("i",{className:"fas fa-cog"})," ",gettext("Settings"))):p.a.createElement("div",{className:"sortable-list-header--empty"},gettext("No indicators")),p.a.createElement(V,{onSortEnd:this.props.dragEndFunc,useDragHandle:!0,lockAxis:"y",lockToContainerEdges:!0},t.map(function(e,t){return p.a.createElement(z,{key:"item-".concat(t),index:t,value:e,disabled:r.props.disabled})})),p.a.createElement("div",{className:"sortable-list-actions"},p.a.createElement(b.a,{readonly:!this.props.level.id||"new"==this.props.level.id||this.props.disabled,programId:this.props.rootStore.levelStore.program_id,levelId:this.props.level.id}))))}}]),t}())||i,z=Object(y.sortableElement)(function(e){var t=e.value;return p.a.createElement("li",{className:"sortable-list__item"},p.a.createElement(q,null),t)}),V=Object(y.sortableContainer)(function(e){var t=e.children;return p.a.createElement("ul",{className:"sortable-list"},t)}),q=Object(y.sortableHandle)(function(){return p.a.createElement("div",{className:"sortable-list__item__drag-handle"},p.a.createElement(f.a,{icon:v.a}))});function K(e){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function H(e,t,r){return t&&B(e.prototype,t),r&&B(e,r),e}function M(e,t){return!t||"object"!==K(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}m.b.add(v.b,v.c);var G,Q,X=Object(u.b)("rootStore")(x=Object(u.c)(x=function(e){function a(){return R(this,a),M(this,J(a).apply(this,arguments))}return U(a,p.a.Component),H(a,[{key:"render",value:function(){var o=this;return("initial"==this.props.renderList?this.props.rootStore.levelStore.sortedLevels.filter(function(e){return-1!=["root",null].indexOf(e.parent)}):this.props.renderList.sort(function(e,t){return e.customsort-t.customsort})).map(function(t){var e="";e=o.props.rootStore.uiStore.activeCard==t.id?p.a.createElement(F,{level:t,levelProps:o.props.rootStore.levelStore.levelProperties[t.id]}):p.a.createElement(L,{level:t,levelProps:o.props.rootStore.levelStore.levelProperties[t.id]});var r=o.props.rootStore.levelStore.sortedLevels.filter(function(e){return e.parent==t.id}),n=null;return 0<r.length&&(n=p.a.createElement(a,{rootStore:o.props.rootStore,renderList:r})),p.a.createElement("div",{key:t.id,className:"leveltier--new"},e,n)})}}]),a}())||x)||x,Z=Object(u.b)("rootStore")(P=Object(u.c)(P=function(e){function t(){return R(this,t),M(this,J(t).apply(this,arguments))}return U(t,p.a.Component),H(t,[{key:"render",value:function(){return 0==this.props.rootStore.levelStore.levels.length?p.a.createElement("div",{className:"level-list-panel"},p.a.createElement("div",{className:"level-list-panel__dingbat"},p.a.createElement("i",{className:"fas fa-sitemap"})),p.a.createElement("div",{className:"level-list-panel__text text-large"},p.a.createElement("strong",{className:"text-danger"},"Choose your results framework template carefully!")," Once you begin building your framework, it will not be possible to change templates without first deleting all saved levels.")):p.a.createElement("div",{id:"level-list",style:{flexGrow:"2"}},p.a.createElement(X,{renderList:"initial"}))}}]),t}())||P)||P,Y=r("y2Vs");function ee(e){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function te(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ne(e,t,r){return t&&re(e.prototype,t),r&&re(e,r),e}function oe(e,t){return!t||"object"!==ee(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function ae(e){return(ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ie(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&le(e,t)}function le(e,t){return(le=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var se,ce,ue,pe,de,me,fe,ve,he,be,ye,ge,Se,Ee,we,_e,Ce=Object(u.b)("rootStore")(G=Object(u.c)(G=function(e){function a(){var e,t;te(this,a);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=oe(this,(e=ae(a)).call.apply(e,[this].concat(n)))).handleChange=function(e){t.props.rootStore.levelStore.changeTierSet(e.value)},t}return ie(a,p.a.Component),ne(a,[{key:"componentDidUpdate",value:function(){$('*[data-toggle="popover"]').popover({html:!0})}},{key:"render",value:function(){var e=null;"locked"==this.props.rootStore.uiStore.tierLockStatus?e=p.a.createElement("a",{href:"#",tabIndex:"0","data-toggle":"popover","data-trigger":"focus","data-html":"true","data-content":gettext('<span class="text-danger"><strong>The results framework template cannot be changed after levels are saved.</strong></span> To change templates, all saved levels first must be deleted.  A level can be deleted when it has no sub-levels and no linked indicators.')},p.a.createElement("i",{className:"far fa-question-circle"})):"primed"==this.props.rootStore.uiStore.tierLockStatus&&(e=p.a.createElement("a",{href:"#",tabIndex:"0","data-toggle":"popover","data-trigger":"focus","data-html":"true","data-content":gettext('<span class="text-danger"><strong>Choose your results framework template carefully!</strong></span> Once you begin building your framework, it will not be possible to change templates without first deleting all saved levels.')},p.a.createElement("i",{className:"far fa-question-circle"})));var t=this.props.rootStore.levelStore.tierTemplates,r=Object.keys(t).map(function(e){return{value:e,label:t[e].name}}),n={value:this.props.rootStore.levelStore.chosenTierSetKey,label:this.props.rootStore.levelStore.chosenTierSetName},o="leveltier-picker__selectbox ";return o+="locked"==this.props.rootStore.uiStore.tierLockStatus?"leveltier-picker__selectbox--disabled":"",p.a.createElement("div",{className:o},p.a.createElement("div",{className:"form-group"},p.a.createElement("label",null,gettext("Results framework template"))," ",p.a.createElement("small",null,e),p.a.createElement(Y.default,{options:r,value:n,isDisabled:"locked"==this.props.rootStore.uiStore.tierLockStatus,onChange:this.handleChange})))}}]),a}())||G)||G,Oe=function(e){function t(){return te(this,t),oe(this,ae(t).apply(this,arguments))}return ie(t,p.a.Component),ne(t,[{key:"render",value:function(){return p.a.createElement("div",{className:"leveltier leveltier--level-"+this.props.tierLevel},this.props.tierName," ")}}]),t}(),Ne=Object(u.b)("rootStore")(Q=Object(u.c)(Q=function(e){function t(){return te(this,t),oe(this,ae(t).apply(this,arguments))}return ie(t,p.a.Component),ne(t,[{key:"render",value:function(){var e=null;return 0==this.props.rootStore.levelStore.levels.length&&(e=p.a.createElement("button",{className:"leveltier-button btn btn-primary btn-block",onClick:this.props.rootStore.levelStore.createFirstLevel},gettext("Apply"))),p.a.createElement(p.a.Fragment,null,p.a.createElement("div",{id:"leveltier-list",className:"leveltier-list"},0<this.props.rootStore.levelStore.chosenTierSet.length?this.props.rootStore.levelStore.chosenTierSet.map(function(e,t){return p.a.createElement(Oe,{key:t,tierLevel:t,tierName:e})}):null),e?p.a.createElement("div",{className:"leveltier-list__actions"},e):null)}}]),t}())||Q)||Q,Te=Object(u.b)("rootStore")(Object(u.c)(function(e){return p.a.createElement("div",{id:"leveltier-picker",className:"leveltier-picker"},p.a.createElement(Ce,null),p.a.createElement(Ne,null))})),ke=r("XoI5");function xe(e,t,r,n){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function Pe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function je(e,t,r){return t&&Pe(e.prototype,t),r&&Pe(e,r),e}function Le(r,n,e,t,o){var a={};return Object.keys(t).forEach(function(e){a[e]=t[e]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=e.slice().reverse().reduce(function(e,t){return t(r,n,e)||e},a),o&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(o):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(r,n,a),a=null),a}function Fe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Ie=(ce=Le((se=function(){function s(e,t,r,n,o,a,i){var l=this;Fe(this,s),xe(this,"levels",ce,this),xe(this,"indicators",ue,this),xe(this,"chosenTierSetKey",pe,this),xe(this,"chosenTierSet",de,this),this.tierTemplates=void 0,this.defaultTemplateKey="",this.customTierSetKey="",this.program_id="",this.accessLevel=!1,xe(this,"cancelEdit",me,this),xe(this,"createNewLevelFromSibling",fe,this),xe(this,"createNewLevelFromParent",ve,this),xe(this,"createFirstLevel",he,this),this.saveLevelTiersToDB=function(){var e={program_id:l.program_id,tiers:l.chosenTierSet};ke.a.post("/save_leveltiers/",e).then(function(e){}).catch(function(e){})},this.deleteLevelFromDB=function(e){var t="".concat(l.levelProperties[e].tierName," ").concat(l.levelProperties[e].ontologyLabel);ke.a.delete("/level/".concat(e)).then(function(e){l.levels.replace(e.data),l.rootStore.uiStore.activeCard=null,0==l.levels.length&&l.createFirstLevel(),success_notice({message_text:gettext("".concat(t," was successfully deleted.")),addClass:"program-page__rationale-form",stack:{dir1:"up",dir2:"right",firstpos1:20,firstpos2:20}})}).catch(function(e){})},this.saveLevelToDB=function(r,t,e,n){e&&l.saveReorderedIndicatorsToDB(n.indicators),delete n.indicators;var o=l.levels.find(function(e){return e.id==t}),a=Object.assign(Object(d.q)(o),n);"new"==t?("root"==a.parent&&l.saveLevelTiersToDB(),delete a.id,ke.a.post("/insert_new_level/",a).then(function(e){Object(d.o)(function(){l.levels.replace(e.data.all_data)});var t=e.data.new_level.id;l.rootStore.uiStore.activeCard=null,"saveAndAddSibling"==r?l.createNewLevelFromSibling(t):"saveAndAddChild"==r&&l.createNewLevelFromParent(t)}).catch(function(e){})):ke.a.put("/level/".concat(t,"/"),a).then(function(e){Object(d.o)(function(){Object.assign(o,e.data)}),l.rootStore.uiStore.activeCard=null,"saveAndAddSibling"==r?l.createNewLevelFromSibling(t):"saveAndAddChild"==r&&l.createNewLevelFromParent(t)}).catch(function(e){}),l.rootStore.uiStore.activeCardNeedsConfirm=!1},this.saveReorderedIndicatorsToDB=function(e){ke.a.post("/reorder_indicators/",e).then(function(e){}).catch(function(e){})},this.deriveTemplateKey=function(){var e=JSON.stringify(Object(d.q)(l.chosenTierSet));for(var t in l.tierTemplates){if(l.tierTemplates.hasOwnProperty(t)&&l.chosenTierSet.length==l.tierTemplates[t].tiers.length)if(e==JSON.stringify(l.tierTemplates[t].tiers))return t}return"custom"},this.buildOntology=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=Object(d.q)(l.levels.find(function(e){return e.id==t}));return r.parent&&"root"!=r.parent?(e.unshift(r.customsort),l.buildOntology(r.parent,e)):e.join(".")},this.getChildLevels=function(t){return l.levels.filter(function(e){return e.parent==t})},this.getLevelIndicators=function(t){return l.indicators.filter(function(e){return e.level==t})},this.getDescendantIndicatorIds=function(t){var e=l.levels.filter(function(e){return t.includes(e.id)}),r=[];return e.forEach(function(t){r=r.concat(l.indicators.filter(function(e){return e.level==t.id}).map(function(e){return e.id}));var e=l.levels.filter(function(e){return e.parent==t.id}).map(function(e){return e.id});r=r.concat(l.getDescendantIndicatorIds(e,r))}),r},this.rootStore=i,this.levels=t,this.indicators=r,this.tierTemplates=o,this.defaultTemplateKey="mc_standard",this.customTierSetKey="custom",this.program_id=e,this.accessLevel=a,0<n.length?(this.chosenTierSet=n.map(function(e){return e.name}),this.chosenTierSetKey=this.deriveTemplateKey(n)):(this.chosenTierSetKey=this.defaultTemplateKey,this.chosenTierSet=this.tierTemplates[this.chosenTierSetKey].tiers)}return je(s,[{key:"changeTierSet",value:function(e){this.chosenTierSetKey=e,this.chosenTierSet=this.tierTemplates[e].tiers}},{key:"sortedLevels",get:function(){return this.levels.slice().sort(function(e,t){e.level_depth-t.level_depth||(e.customsort,t.customsort)})}},{key:"levelProperties",get:function(){var o=this,a={},e=!0,t=!1,r=void 0;try{for(var i,n=function(){var t=i.value,e={},r=o.getChildLevels(t.id).map(function(e){return e.id}),n=o.indicators.filter(function(e){return e.level==t.id});e.indicators=o.getLevelIndicators(t.id),e.descendantIndicatorIds=o.getDescendantIndicatorIds(r),e.ontologyLabel=o.buildOntology(t.id),e.tierName=o.chosenTierSet[t.level_depth-1],e.childTierName=null,o.chosenTierSet.length>t.level_depth&&(e.childTierName=o.chosenTierSet[t.level_depth]),e.canDelete=0==r.length&&0==n&&"high"==o.accessLevel,e.canEdit="high"==o.accessLevel,a[t.id]=e},l=this.levels[Symbol.iterator]();!(e=(i=l.next()).done);e=!0)n()}catch(e){t=!0,r=e}finally{try{e||null==l.return||l.return()}finally{if(t)throw r}}return a}},{key:"chosenTierSetName",get:function(){return this.chosenTierSetKey==this.customTierSetKey?"Custom":this.tierTemplates[this.chosenTierSetKey].name}}]),s}()).prototype,"levels",[d.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ue=Le(se.prototype,"indicators",[d.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),pe=Le(se.prototype,"chosenTierSetKey",[d.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),de=Le(se.prototype,"chosenTierSet",[d.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Le(se.prototype,"sortedLevels",[d.e],Object.getOwnPropertyDescriptor(se.prototype,"sortedLevels"),se.prototype),Le(se.prototype,"levelProperties",[d.e],Object.getOwnPropertyDescriptor(se.prototype,"levelProperties"),se.prototype),Le(se.prototype,"chosenTierSetName",[d.e],Object.getOwnPropertyDescriptor(se.prototype,"chosenTierSetName"),se.prototype),Le(se.prototype,"changeTierSet",[d.d],Object.getOwnPropertyDescriptor(se.prototype,"changeTierSet"),se.prototype),me=Le(se.prototype,"cancelEdit",[d.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){if("new"==t){var r=e.levels.find(function(e){return e.id==t});e.levels.filter(function(e){return e.customsort>r.customsort&&e.parent==r.parent}).forEach(function(e){return e.customsort-=1}),e.levels.replace(e.levels.filter(function(e){return"new"!=e.id}))}e.rootStore.uiStore.removeActiveCard()}}}),fe=Le(se.prototype,"createNewLevelFromSibling",[d.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var n=this;return function(t){var r=Object(d.q)(n.levels.find(function(e){return e.id==t})),e=Object.assign({},r);e.customsort+=1,e.id="new",e.name="",e.assumptions="",n.levels.filter(function(e){return r&&e.customsort>r.customsort&&e.parent==r.parent}).forEach(function(e){return e.customsort+=1}),n.rootStore.uiStore.activeCard="new",n.levels.push(e),setTimeout(function(){$("#level-card-new")[0].scrollIntoView({behavior:"smooth"})},100)}}}),ve=Le(se.prototype,"createNewLevelFromParent",[d.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var n=this;return function(t){var e=Object(d.q)(n.levels.find(function(e){return e.id==t})),r={id:"new",customsort:1,name:"",assumptions:"",parent:t,level_depth:e.level_depth+1,program:n.program_id};n.levels.filter(function(e){return e.parent==t}).forEach(function(e){return e.customsort+=1}),n.rootStore.uiStore.activeCard="new",n.levels.push(r),n.rootStore.uiStore.hasVisibleChildren.push(r.parent)}}}),he=Le(se.prototype,"createFirstLevel",[d.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(){var e={id:"new",program:t.program_id,name:"",assumptions:"",customsort:1,level_depth:1,parent:"root"};t.levels.push(e),t.rootStore.uiStore.activeCard="new"}}}),se),De=(ye=Le((be=function(){function t(e){Fe(this,t),xe(this,"activeCard",ye,this),xe(this,"hasVisibleChildren",ge,this),this.activeCardNeedsConfirm="",xe(this,"editCard",Se,this),xe(this,"onLeaveConfirm",Ee,this),this.onLeaveCancel=function(){$(".edit-button").prop("disabled",!1)},xe(this,"removeActiveCard",we,this),xe(this,"updateVisibleChildren",_e,this),this.rootStore=e,this.hasVisibleChildren=this.rootStore.levelStore.levels.map(function(e){return e.id}),this.activeCardNeedsConfirm=!1}return je(t,[{key:"tierLockStatus",get:function(){return 0<this.rootStore.levelStore.levels.filter(function(e){return"new"!=e.id}).length?"locked":1==this.rootStore.levelStore.levels.length?"primed":null}}]),t}()).prototype,"activeCard",[d.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ge=Le(be.prototype,"hasVisibleChildren",[d.m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Le(be.prototype,"tierLockStatus",[d.e],Object.getOwnPropertyDescriptor(be.prototype,"tierLockStatus"),be.prototype),Se=Le(be.prototype,"editCard",[d.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var r=this;return function(e){if(r.activeCardNeedsConfirm){$("#level-card-".concat(r.activeCard))[0].scrollIntoView({behavior:"smooth"});var t=r.rootStore.levelStore.levelProperties[r.activeCard].tierName;$(".edit-button").prop("disabled",!0),create_no_rationale_changeset_notice({message_text:gettext("Are you sure you want to continue?"),preamble:gettext("Changes to this ".concat(t," will not be saved")),on_submit:function(){return r.onLeaveConfirm(e)},on_cancel:r.onLeaveCancel})}else r.activeCard=e}}}),Ee=Le(be.prototype,"onLeaveConfirm",[d.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){$(".edit-button").prop("disabled",!1),t.activeCard=e,setTimeout(function(){$("#level-card-".concat(e))[0].scrollIntoView({behavior:"smooth"})},100),t.activeCardNeedsConfirm=!1}}}),we=Le(be.prototype,"removeActiveCard",[d.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.activeCard=null}}}),_e=Le(be.prototype,"updateVisibleChildren",[d.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var r=this;return function(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];2<arguments.length&&void 0!==arguments[2]&&arguments[2];0<=r.hasVisibleChildren.indexOf(t)||e?(r.hasVisibleChildren=r.hasVisibleChildren.filter(function(e){return e!=t}),r.rootStore.levelStore.levels.filter(function(e){return e.parent==t}).forEach(function(e){return r.updateVisibleChildren(e.id,!0)})):r.hasVisibleChildren.push(t)}}}),be),Ae=jsContext,ze=new function e(t,r,n,o,a,i){Fe(this,e),this.levelStore=new Ie(t,r,n,o,a,i,this),this.uiStore=new De(this)}(Ae.program_id,Ae.levels,Ae.indicators,Ae.levelTiers,Ae.tierTemplates,Ae.accessLevel);c.a.render(p.a.createElement(u.a,{rootStore:ze},p.a.createElement(p.a.Fragment,null,p.a.createElement(Te,null),p.a.createElement(Z,null))),document.querySelector("#level-builder-react-component"))},XoI5:function(e,t,r){"use strict";r.d(t,"a",function(){return o});var n=r("vDqi"),o=r.n(n).a.create({withCredentials:!0,baseURL:"/api/",headers:{"X-CSRFToken":document.cookie.replace(/(?:(?:^|.*;\s*)csrftoken\s*\=\s*([^;]*).*$)|^.*$/,"$1")}})},hzyr:function(e,t,r){"use strict";r.d(t,"a",function(){return l});var n=r("q1tI"),o=r.n(n),a=r("okNM");function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],0<=t.indexOf(r)||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=Object(a.c)(function(e){var t=e.readonly,r=i(e,["readonly"]);return o.a.createElement("button",{disabled:t,className:"btn btn-link btn-add",onClick:function(e){return openCreateIndicatorFormModal(r)}},o.a.createElement("i",{className:"fas fa-plus-circle"})," ",gettext("Add indicator"))})},qtBC:function(e,t,r){"use strict";var n=r("7+Rn"),o=r.n(n)()();t.a=o}},[["QTZG",0,1]]]);