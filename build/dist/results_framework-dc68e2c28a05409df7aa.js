(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{QTZG:function(e,t,r){"use strict";r.r(t);var n,o,i=r("q1tI"),l=r.n(i),a=r("i8i4"),s=r.n(a),c=r("okNM"),u=(r("qtBC"),r("TSYQ"),r("2vnA")),p=r("7O5W"),f=(r("IP2g"),r("wHSu"));function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function m(e,t,r){return t&&h(e.prototype,t),r&&h(e,r),e}function b(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?y(e):t}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}p.b.add(f.a,f.b);var w,O=function(e){function t(){return d(this,t),b(this,S(t).apply(this,arguments))}return g(t,l.a.Component),m(t,[{key:"render",value:function(){return l.a.createElement("h3",{className:"level-title "+this.props.classes},this.props.tierName,this.props.ontologyLabel?" "+this.props.ontologyLabel:null)}}]),t}(),C=Object(c.b)("rootStore")(n=Object(c.c)(n=function(e){function r(e){var t;return d(this,r),(t=b(this,S(r).call(this,e))).editLevel=function(){t.props.rootStore.uiStore.addExpandedCard(t.props.level.id)},t.deleteLevel=t.deleteLevel.bind(y(y(t))),t.editLevel=t.editLevel.bind(y(y(t))),t}return g(r,l.a.Component),m(r,[{key:"deleteLevel",value:function(){document.getElementById(this.props.level.id)}},{key:"render",value:function(){return l.a.createElement("div",{className:"level-card level-card--collapsed",id:this.props.level.id},l.a.createElement("div",{className:"level-card--collapsed__name"},l.a.createElement("strong",null,l.a.createElement(O,{tierName:this.props.levelProps.tierName,ontologyLabel:this.props.levelProps.ontologyLabel,classes:"level-title--collapsed"})),l.a.createElement("span",null," ",this.props.level.name)),l.a.createElement("div",{className:"level-card--collapsed__actions"},l.a.createElement("div",{className:"actions__top",style:{display:"flex",justifyContent:"flex-end"}},this.props.levelProps.canDelete&&l.a.createElement("button",{className:"btn btn-sm btn-link btn-danger",onClick:this.deleteLevel},l.a.createElement("i",{className:"fas fa-trash-alt"})," ",gettext("Delete")),l.a.createElement("button",{className:"btn btn-sm btn-link btn-text",onClick:this.editLevel},l.a.createElement("i",{className:"fas fa-edit"})," ",gettext("Edit"))),l.a.createElement("div",{className:"actions__bottom",style:{display:"flex",justifyContent:"flex-end"}},l.a.createElement("button",{className:"btn btn-sm btn-link"},"Indicators"))))}}]),r}())||n)||n,j=Object(c.b)("rootStore")(o=Object(c.c)(o=function(e){function r(e){var t;return d(this,r),(t=b(this,S(r).call(this,e))).saveLevel=function(e){e.preventDefault(),t.props.rootStore.levelStore.saveLevelToDB(t.props.level.id)},t.onFormChange=t.onFormChange.bind(y(y(t))),t}return g(r,l.a.Component),m(r,[{key:"saveAndCreateChild",value:function(){this.props.rootStore.levelStore.saveAndAddChildLevel(this.props.level.id)}},{key:"saveAndCreateSibling",value:function(){this.props.rootStore.levelStore.saveAndAddChildLevel(this.props.level.id)}},{key:"onFormChange",value:function(e){this.props.level[e.target.name]=e.target.value}},{key:"render",value:function(){return l.a.createElement("div",{className:"level-card level-card--expanded",id:this.props.level.id},l.a.createElement("div",null,l.a.createElement(O,{tierName:this.props.levelProps.tierName,ontologyLabel:this.props.levelProps.ontologyLabel,classes:"level-title--expanded"})),l.a.createElement("form",{className:"level-card--expanded__form",onSubmit:this.saveLevel},l.a.createElement("textarea",{className:"form-control",type:"text",id:"level-name",name:"name",value:this.props.level.name||"",onChange:this.onFormChange}),l.a.createElement("label",{htmlFor:"assumptions"},"Assumptions"),l.a.createElement("textarea",{className:"form-control",type:"text",id:"level-assumptions",name:"assumptions",value:this.props.level.assumptions||"",onChange:this.onFormChange}),l.a.createElement(N,null)))}}]),r}())||o)||o,N=function(e){function t(){return d(this,t),b(this,S(t).apply(this,arguments))}return g(t,l.a.Component),m(t,[{key:"render",value:function(){return l.a.createElement("div",{className:"button-bar"},l.a.createElement(x,{classes:"btn-primary",text:gettext("Save and close")}),l.a.createElement(x,{classes:"btn-primary",text:gettext("Save and another")}),l.a.createElement(x,{classes:"btn-primary",text:gettext("Save and link")}))}}]),t}(),x=function(e){function t(){return d(this,t),b(this,S(t).apply(this,arguments))}return g(t,l.a.Component),m(t,[{key:"render",value:function(){return l.a.createElement("button",{type:"submit",className:this.props.classes+" level-button btn"},this.props.text)}}]),t}();function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function L(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function T(e,t){return(T=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}p.b.add(f.a,f.b);var z,A,D=Object(c.b)("rootStore")(w=Object(c.c)(w=function(e){function i(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),L(this,P(i).apply(this,arguments))}var t,r,n;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&T(e,t)}(i,l.a.Component),t=i,(r=[{key:"render",value:function(){var o=this;return("initial"==this.props.renderList?this.props.rootStore.levelStore.levels.filter(function(e){return null==e.parent}).sort(function(e){return e.customsort}):this.props.renderList.sort(function(e){return e.customsort})).map(function(t){var e="";e=-1!==o.props.rootStore.uiStore.expandedCards.indexOf(t.id)?l.a.createElement(j,{level:t,levelProps:o.props.rootStore.levelStore.levelProperties[t.id]}):l.a.createElement(C,{level:t,levelProps:o.props.rootStore.levelStore.levelProperties[t.id]});var r=o.props.rootStore.levelStore.levels.filter(function(e){return e.parent==t.id}),n=null;return 0<r.length&&(n=l.a.createElement(i,{rootStore:o.props.rootStore,renderList:r})),l.a.createElement("div",{key:t.id,className:"leveltier--new"},e,n)})}}])&&k(t.prototype,r),n&&k(t,n),i}())||w)||w,F=Object(c.c)(function(e){return l.a.createElement("div",{id:"level-list",style:{flexGrow:"2"}},l.a.createElement(D,{renderList:"initial"}))}),R=r("y2Vs");function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function q(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function J(e,t,r){return t&&q(e.prototype,t),r&&q(e,r),e}function G(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(e):t}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function X(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$(e,t)}function $(e,t){return($=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Z,H,M,U,V,W,Y,K,ee,te,re,ne=Object(c.b)("rootStore")(z=Object(c.c)(z=function(e){function i(){var e,t;I(this,i);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=G(this,(e=Q(i)).call.apply(e,[this].concat(n)))).handleChange=function(e){t.props.rootStore.levelStore.changeTierSet(e.value)},t}return X(i,l.a.Component),J(i,[{key:"render",value:function(){var e=Object.keys(this.props.rootStore.levelStore.tierPresets).map(function(e){return{value:e,label:e}}),t={value:this.props.rootStore.levelStore.chosenTierSet,label:this.props.rootStore.levelStore.chosenTierSetName};return l.a.createElement("div",{className:"leveltier-picker__selectbox"},"Results framework template",l.a.createElement(R.default,{options:e,value:t,onChange:this.handleChange}))}}]),i}())||z)||z,oe=function(e){function t(){return I(this,t),G(this,Q(t).apply(this,arguments))}return X(t,l.a.Component),J(t,[{key:"render",value:function(){return l.a.createElement("div",{className:"leveltier leveltier--level-"+this.props.tierLevel},this.props.tierName," ")}}]),t}(),ie=Object(c.b)("rootStore")(A=Object(c.c)(A=function(e){function t(){return I(this,t),G(this,Q(t).apply(this,arguments))}return X(t,l.a.Component),J(t,[{key:"render",value:function(){return l.a.createElement("div",{id:"leveltier-list",className:"leveltier-list"},0<this.props.rootStore.levelStore.tierList.length?this.props.rootStore.levelStore.tierList.map(function(e,t){return l.a.createElement(oe,{key:t,tierName:e})}):null)}}]),t}())||A)||A,le=Object(c.c)(function(e){return l.a.createElement("div",{id:"leveltier-picker",className:"leveltier-picker"},l.a.createElement(ne,null),l.a.createElement(ie,null))}),ae=r("XoI5");function se(e,t,r,n){r&&Object.defineProperty(e,t,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(n):void 0})}function ce(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ue(r,n,e,t,o){var i={};return Object.keys(t).forEach(function(e){i[e]=t[e]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=e.slice().reverse().reduce(function(e,t){return t(r,n,e)||e},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(r,n,i),i=null),i}function pe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var fe=(H=ue((Z=function(){function i(e,t,r,n){var o=this;pe(this,i),se(this,"levels",H,this),se(this,"chosenTierSet",M,this),se(this,"chosenTierSetName",U,this),this.tierPresets={},se(this,"saveAndAddSiblingLevel",V,this),se(this,"createNewLevelFromSibling",W,this),this.saveLevelToDB=function(r){var e=Object(u.o)(o.levels).filter(function(e){return e.id==r})[0];"new"==r||ae.a.put("/level/".concat(r,"/"),e).then(function(e){var t=o.levels.find(function(e){return e.id==r});Object(u.m)(function(){Object.assign(t,e.data)}),o.rootStore.uiStore.removeExpandedCard(r)}).catch(function(e){});o.levels.find(function(e){return e.id==r})},this.rootStore=n,this.levels=e,this.tierPresets=r,0<t.length&&(this.chosenTierSet=t,this.chosenTierSetName=this.derive_preset_name(t,r))}var e,t,r;return e=i,(t=[{key:"changeTierSet",value:function(e){this.chosenTierSetName=e}},{key:"derive_preset_name",value:function(e,t){if(!e)return None;var r=e.sort(function(e){return e.tier_depth}).map(function(e){return e.name}),n=JSON.stringify(r);for(var o in t){if(e.length==t[o].length)if(n==JSON.stringify(t[o]))return o}return"Custom"}},{key:"tierList",get:function(){return this.chosenTierSet||this.chosenTierSetName?this.chosenTierSetName in this.tierPresets?this.tierPresets[this.chosenTierSetName]:this.chosenTierSet:[]}},{key:"levelProperties",get:function(){var n=this,o={},e=!0,t=!1,r=void 0;try{for(var i,l=function(){var t=i.value,e={};e.ontologyLabel=t.ontology.split(".").slice(1).filter(function(e){return 0<e}).join("."),e.tierName=n.tierList[t.level_depth-1];var r=n.levels.filter(function(e){return e.parent==t.id}).length;e.canDelete=0==r,o[t.id]=e},a=this.levels[Symbol.iterator]();!(e=(i=a.next()).done);e=!0)l()}catch(e){t=!0,r=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}return o}}])&&ce(e.prototype,t),r&&ce(e,r),i}()).prototype,"levels",[u.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),M=ue(Z.prototype,"chosenTierSet",[u.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),U=ue(Z.prototype,"chosenTierSetName",[u.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ue(Z.prototype,"tierList",[u.e],Object.getOwnPropertyDescriptor(Z.prototype,"tierList"),Z.prototype),ue(Z.prototype,"levelProperties",[u.e],Object.getOwnPropertyDescriptor(Z.prototype,"levelProperties"),Z.prototype),ue(Z.prototype,"changeTierSet",[u.d],Object.getOwnPropertyDescriptor(Z.prototype,"changeTierSet"),Z.prototype),V=ue(Z.prototype,"saveAndAddSiblingLevel",[u.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){level=e.levels.find(function(e){return e.id=t}),e.saveLevelToDB(t),e.createNewLevel(t)}}}),W=ue(Z.prototype,"createNewLevelFromSibling",[u.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){sibling=e.levels.find(function(e){return e.id==t})}}}),Z),ve=(K=ue((Y=function e(t){pe(this,e),se(this,"expandedCards",K,this),se(this,"activeLevel",ee,this),se(this,"addExpandedCard",te,this),se(this,"removeExpandedCard",re,this),this.rootStore=t}).prototype,"expandedCards",[u.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ee=ue(Y.prototype,"activeLevel",[u.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),te=ue(Y.prototype,"addExpandedCard",[u.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var t=this;return function(e){t.expandedCards.includes(e)||t.expandedCards.push(e)}}}),re=ue(Y.prototype,"removeExpandedCard",[u.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.expandedCards=e.expandedCards.filter(function(e){return e!=t})}}}),Y),de=jsContext,he=new function e(t,r,n){pe(this,e),this.levelStore=new fe(t,r,n,this),this.uiStore=new ve(this)}(de.levels,de.levelTiers,de.tierPresets);s.a.render(l.a.createElement(c.a,{rootStore:he},l.a.createElement(l.a.Fragment,null,l.a.createElement(le,null),l.a.createElement(F,null))),document.querySelector("#level-builder-react-component"))},XoI5:function(e,t,r){"use strict";r.d(t,"a",function(){return o});var n=r("vDqi"),o=r.n(n).a.create({withCredentials:!0,baseURL:"/api/",headers:{"X-CSRFToken":document.cookie.replace(/(?:(?:^|.*;\s*)csrftoken\s*\=\s*([^;]*).*$)|^.*$/,"$1")}})},qtBC:function(e,t,r){"use strict";var n=r("7+Rn"),o=r.n(n)()();t.a=o}},[["QTZG",0,1]]]);