## TolaActivity Internationalization Documentation

### How Django discovers language preference
Django uses the LocaleMiddleware to discover language preference for individual users. The __LocaleMiddleware__ enables language selection through the request context.

- In order to determine a user's language preferences through the request context, activate __LocaleMiddleware__ by adding it to __MIDDLEWARE__ in your settings (tola/settings/base.py) as one of the topmost classes, before __CommonMiddleware__, but after __SessionMiddleware__.
`MIDDLEWARE_CLASSES = (
    ...
    'django.middleware.locale.LocaleMiddleware',
    ...
)`

__LocaleMiddle__ looks for the language prefix in the requested URL. (For further information about Django's algorithm to determine language preference see https://docs.djangoproject.com/en/1.11/topics/i18n/translation/) Language prefixes are added by using the __i18n_patterns__ function in the root URLconf. Django will automatically prepend the current active language code to all url patterns defined within __i18n_patterns()__.

- `from django.conf.urls.i18n import i18n_patterns`  and add
`urlpatterns += i18n_patterns(
    url(r'^$', views.index, name='index'),
    url(r'^(?P<selected_countries>\w+)/$', views.index, name='index'),
    url(r'^$', TemplateView.as_view(template_name='base.html')),
    prefix_default_language=False
)`
or any other url you would like to be translated to the root urlconf (tola/urls.py). (Don't forget to remove these urls from urlpatterns, otherwise Django will never discover your __i18n_patterns__ since url discovery takes place in order.)

### Translation
In order for strings to be translated by Django, you have to add hooks, called __translation stringgs__ to your templates and Python code. Django then extracts the translation strings into a message file where the translators will provide the equivalent strings in the target languages. Django looks for a __locale__ directory listed in the __LOCALE_PATH__ to create, compile and load message files with translation strings.

- Create __locale__ directory in tola project directory to save translation files. In this directory Django will create locale_code_for_each_languages/LC_MESSAGES directories for each language specified and within each a django.po file with the the translation strings.

- Specify the __LOCALE_PATHS__ in tola/settings/base.py like so:
`LOCALE_PATHS = [
    join(DJANGO_ROOT, 'locale'),
]`
This is where Django will create and look for translation files.

- In tola/settings/base.py import __ugettext_lazy__ function
`from django.utils.translation import ugettext_lazy as _`
The u prefix represents unicode strings in Python 2. In Python 3 __gettext()__ and __ugettext()__ can be used interchangeably.
The __ugettext_lazy__ function is used here to mark the language names for translation. Different from the __ugettext__ function which translate the string immediately, __ugetttext_lazy__ stores a lazy reference to the string and translates the string when it is used in context, such as rendering a template.

- Add list of languages available for selection.
`LANGUAGES = [
    ('fr', _('French')),
    ('es', _('Spanish')),
    ('ar', _('Arabic')),
    ('en', _('English')),
]`

- Make sure __USE_I18N__ is set to __True__.

### Internationalization: in template code

Django uses two template tags for string translations in templates. The __{% trans %}__ translates either a constant string or  a variable content. The __{% blocktrans %}__ marks longer strings or complex sentences consisting of variables and literals. In order to access these tags __{% load i18n %}__ must be places toward the top of the template.

- Before the creation of the messagefile make sure GNU gettext() is installed and make sure it is symlinked or set a new PATH variable for your virtual environment.

- To create a messagefile after tags have been added, run `python manage.py makemessages -l fr` (to make a messagefile in French). Fill in translation strings and run `python manage.py compilemessages -l fr`.

