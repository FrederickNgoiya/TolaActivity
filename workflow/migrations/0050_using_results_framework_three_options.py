# -*- coding: utf-8 -*-
# Generated by Django 1.11.21 on 2019-06-11 18:37
from __future__ import unicode_literals

from django.db import migrations, models

NOT_MIGRATED = 1 # programs created before satsuma release which have not switched over yet
MIGRATED = 2 # programs created before satsuma which have switched to new RF levels
RF_ALWAYS = 3 # programs created after satsuma release - on new RF levels with no option

def copy_over_values(apps, schema_editor):
    Program = apps.get_model('workflow', 'Program')
    for program in Program.objects.filter(using_results_framework=True):
        program._using_results_framework = MIGRATED
        program.save()
    for program in Program.objects.filter(using_results_framework=False):
        program._using_results_framework = NOT_MIGRATED
        program.save()

def reverse_copy_values(apps, schema_editor):
    Program = apps.get_model('workflow', 'Program')
    for program in Program.objects.all():
        if program._using_results_framework == NOT_MIGRATED:
            program.using_results_framework = False
        else:
            program.using_results_framework = True
        program.save()

class Migration(migrations.Migration):

    dependencies = [
        ('workflow', '0049_program_auto_number_indicators'),
    ]

    operations = [
        migrations.AddField(
            model_name='program',
            name='_using_results_framework',
            field=models.IntegerField(
                default=RF_ALWAYS,
                verbose_name='Group indicators according to the results framework'
            ),
        ),
        migrations.RunPython(copy_over_values, reverse_code=reverse_copy_values),
        migrations.RemoveField(
            model_name='program',
            name="using_results_framework"
        )
    ]
